---
layout: post
title:  "Kafka 简介"
date:   2021-08-27 15:07:39
categories: Kafka
---


Apache Kafka被定位为一个分布式流式处理平台，主要包括高吞吐、可持久化、可水平扩展、支持流数据处理等特性。目前Kafka主要应用场景有三类：

* 消息系统：除与传统消息系统都具备的**系统解耦、流量削峰、异步通信、冗余存储、可恢复**等功能外，Kafka还提供**消息顺序性保障及回溯消费**的功能。
* 存储系统：基于Kafka的**消息持久化(磁盘文件)及多副本机制**，可将Kafka作为长期的数据存储系统使用。且提供**可配置的数据保留策略及日志压缩功能**。
* 流式处理平台：为流式处理框架提供可靠地数据来源，及完整的流式处理类库，如窗口、连接、聚合、变换等各类操作。


技术架构设计

Kafka架构上主要四部分：

Producer：消息生产者

Consumer：消息消费者

Broker：服务节点

Zookeeper：负责集群元数据管理、控制器选举等操作


消息管理设计


主题：

Kafka中的消息以主题(Topic)为单位进行管理，生产者负责将消息发送到特定的主题，而消费者负责订阅主题并进行消费。

分区：

主题是一个逻辑上的概念，它还可以细分为多个分区，一个分区只属于单个主题，消息存储是基于分区进行存储的，每个分区可被视作一个可追加的日志文件，消息在被追加到分区日志文件后都会
分配一个特定的**偏移量(offset)作为该消息在分区内的唯一标识**，kafka**通过offset来保证消息在分区内的顺序性**，即kafka保证分区有序而不是主体有序。一个主题的分区可以分布
在不同的broker中，多个分区可以并发的写入，以实现kafka的高吞吐及可扩展性.


多副本机制：

kafka为提升分区的容灾能力，保证可用性，为分区引入了多副本(Replica)机制，同一个分区的副本保存的信息相同(同一时刻，复制存在延迟，并非完全一样)，副本间是"一主多从"的关系，
其中leader副本负责处理消息的读写请求，其它副本为follower副本，只负责与leader副本的消息同步。

分区的所有副本组成的集合为AR(assigned replicas)，与leader副本保持一定程度同步的副本(包含leader副本在内)组成的副本集合为ISR(in-sync replicas)，与leader副本同步滞后
过多的副本组成副本集合OSR(out-of-sync replicas)，









