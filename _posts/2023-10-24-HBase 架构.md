---
layout: post 
title:  HBase 架构
date:   2023-10-24 22:40:28 
categories: Hbase
---

Apache HBase是一个开源的、分布式的、数据多版本的NoSQL数据库, 项目是Google Bigtable的开源实现，适用于存储半结构化或非结构化的数据，且能够动态扩展列数，能够支撑在数十亿行 X 数百万列的大表上进行随机、实时的
读写访问。底层利用 Hadoop 分布式文件系统（Hadoop Distributed File System，HDFS）提供分布式数据存储。


# Hbase架构

![Hbase 架构](https://raw.githubusercontent.com/GuanN1ng/diagrams/main/com.guann1n9.diagrams/hbase/hbase_arc.png)

## Zookeeper

Zookeeper在HBase是沟通一切的桥梁，所有的参与者都和Zookeeper保持心跳会话，并从Zookeeper获取它们需要的集群状态信息，Zookeeper即维护了当前集群状态，也在保证了Hbase的一致性，其作用主要如下：
* 维护当前Hbase集群元信息，包括HMaster、HRegionServer、Namespace、Table等信息；
* 实现**HMaster高可用**，多个HMaster进程只会有一个状态为Active，其余为Backup，通过抢占ZK`/hbase/master`节点实现。若状态为Active的HMaster进程宕机，则所有状态为Backup的HMaster会再次通过抢占ZK`/hbase/master`节点完成选举新的Active HMaster;
* 供Client查询获取HBase元信息。

## HMaster

HMaster负责当前HBase集群的管理工作，主要职责如下：
* 通过监听ZK `rs`节点获取当前RegionServer列表，若有RegionServer节点过期，则处理RegionServer的故障转移，以及空闲时，对RegionServer进行负载均衡，调整Region的分配，防止RegionServer数据倾斜过载；
* 处理用户对元数据变更的请求，如表的创建、修改、删除以及Region的移动、合并、拆分；
* 管理Region的分配与移除。


## HRegionServer

RegionServer是HBase最核心的组件，客户端发起的所有数据请求，包括用户数据以及元数据，在完成目标Region定位后，将会直接请求目标Region所在的RegionServer，最后由RegionServer完成数据的读写操作。同时，
RegionServer还将向HMaster（Active）定期汇报自身节点的负载状况，包括RS内存使用状态、在线状态的Region等信息，参与Master的分布式协调管理。

一个RegionServer实例主要包含三部分组件：
* HLog是WAL（Write Ahead Log）预写日志的实现，用于保证Region数据操作的原子性和持久性；
* BlockCache负责缓存从HDFS读取的数据块，提升数据读取性能；
* Region是HBase中实现表的分布式及高可用的基本元素——数据分片，一般有多个Store组成，每Store只负责维护一个列簇。若一张表有2个列簇，则该表的所有Region都将有2个Store。

### HLog



### BlockCache


### HRegion

#### HStore